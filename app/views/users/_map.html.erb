<meta name="viewport" content="initial-scale=1.0, user-scalable=no">

<style>
  html, body, #map-canvas {
    height: 400px;
    width: 400px;
    margin: 0px;
    padding: 0px
  }
</style>

<script type="text/javascript"
 src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_API_KEY'] %>&sensor=false">
</script>

<script type="text/javascript">
  function initialize() {

    var mapOptions = {
      zoom: 10,
      center: new google.maps.LatLng(40.7577, -73.9857),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var map = new google.maps.Map(document.getElementById("map-canvas"),
        mapOptions);
    var bounds = new google.maps.LatLngBounds();

    <% photos.each do |photo| %>
      <% if photo.location != "" && photo.location != nil %>
        createMarker(
          <%= photo.latitude %>,
          <%= photo.longitude %>,
          "<%= photo.description %>",
          "<%= photo.location %>")
        bounds.extend(new google.maps.LatLng(
          <%= photo.latitude %>,
          <%= photo.longitude %>))
        <% end %>
    <% end %>

    <% if photos.length > 0  %>
      map.fitBounds(bounds);
    <% end %>

    function createMarker(lat, lng, desc, loc) {
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat, lng),
        map: map,
        title: loc
      });

      google.maps.event.addListener(marker, 'click', function() {
        var contentString =
          '<div id="info"><h3>'+loc+'</h3><p>'+desc+'</p></div>'

        if (!this.getMap()._infoWindow){
          this.getMap()._infoWindow = new google.maps.InfoWindow();
        }
        this.getMap()._infoWindow.close();
        this.getMap()._infoWindow.setContent(contentString);
        this.getMap()._infoWindow.open(this.getMap(), this);
      });

    };
  }

  google.maps.event.addDomListener(window, 'load', initialize);

</script>